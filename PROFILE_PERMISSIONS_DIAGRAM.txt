╔══════════════════════════════════════════════════════════════════════════════╗
║                    PROFILE PERMISSIONS ARCHITECTURE                          ║
╚══════════════════════════════════════════════════════════════════════════════╝

┌─────────────────────────────────────────────────────────────────────────────┐
│                          PERMISSION HIERARCHY                                │
└─────────────────────────────────────────────────────────────────────────────┘

                        Profile Management Module
                                   │
                ┌──────────────────┼──────────────────┐
                │                  │                  │
         ┌──────▼──────┐   ┌──────▼──────┐   ┌──────▼──────┐
         │   ADMIN      │   │   STANDARD   │   │   SPECIAL   │
         │ PERMISSIONS  │   │ PERMISSIONS  │   │ PERMISSIONS │
         └──────┬──────┘   └──────┬──────┘   └──────┬──────┘
                │                  │                  │
    ┌───────────┼───────────┐      │         ┌────────┴────────┐
    │           │           │      │         │                 │
┌───▼───┐  ┌───▼───┐  ┌───▼───┐  │    ┌───▼───┐        ┌───▼───┐
│ View  │  │ Edit  │  │Delete │  │    │ View  │        │Update │
│ All   │  │ All   │  │Profile│  │    │ Own   │        │ Bank  │
└───────┘  └───────┘  └───────┘  │    └───────┘        └───────┘
                                  │
                             ┌────▼────┐
                             │  Edit   │
                             │  Own    │
                             └─────────┘


┌─────────────────────────────────────────────────────────────────────────────┐
│                          ROLE PERMISSION MATRIX                              │
└─────────────────────────────────────────────────────────────────────────────┘

╔═══════════════╦═══════════╦═══════════╦═══════════╦═══════════╦═══════════╗
║     ROLE      ║ View Own  ║ Edit Own  ║ View All  ║ Edit All  ║   Bank    ║
╠═══════════════╬═══════════╬═══════════╬═══════════╬═══════════╬═══════════╣
║ Super Admin   ║     ✓     ║     ✓     ║     ✓     ║     ✓     ║     ✓     ║
║ Admin         ║     ✓     ║     ✓     ║     ✓     ║     ✓     ║     ✓     ║
║ HR            ║     ✓     ║     ✓     ║     ✗     ║     ✗     ║     ✓     ║
║ Employee      ║     ✓     ║     ✓     ║     ✗     ║     ✗     ║     ✗     ║
║ Receptionist  ║     ✓     ║     ✓     ║     ✗     ║     ✗     ║     ✗     ║
║ Customer      ║     ✓     ║     ✓     ║     ✗     ║     ✗     ║     ✗     ║
║ Custom Role   ║     ✓     ║     ✓     ║     ✗     ║     ✗     ║     ✗     ║
╚═══════════════╩═══════════╩═══════════╩═══════════╩═══════════╩═══════════╝


┌─────────────────────────────────────────────────────────────────────────────┐
│                          PERMISSION FLOW                                     │
└─────────────────────────────────────────────────────────────────────────────┘

    User Accesses /profile
            │
            ▼
    ┌───────────────────┐
    │ ProfileController │
    │   edit() method   │
    └─────────┬─────────┘
              │
              ▼
    ┌─────────────────────────────────────┐
    │ Check: Can view own profile?        │
    └─────────┬───────────────────────────┘
              │
         ┌────┴────┐
         │         │
        YES       NO
         │         │
         ▼         ▼
    ┌────────┐  ┌──────────┐
    │ Allow  │  │ 403 Error│
    └────┬───┘  └──────────┘
         │
         ▼
    ┌─────────────────────────────────────┐
    │ Load Profile View                   │
    └─────────┬───────────────────────────┘
              │
              ▼
    ┌─────────────────────────────────────┐
    │ Check: Can edit own profile?        │
    └─────────┬───────────────────────────┘
              │
         ┌────┴────┐
         │         │
        YES       NO
         │         │
         ▼         ▼
    ┌────────┐  ┌──────────┐
    │Editable│  │ Readonly │
    │ Fields │  │  Fields  │
    └────────┘  └──────────┘


┌─────────────────────────────────────────────────────────────────────────────┐
│                     AUTOMATIC ASSIGNMENT FLOW                                │
└─────────────────────────────────────────────────────────────────────────────┘

    Run: php sync_all_profile_permissions.php
                    │
                    ▼
    ┌───────────────────────────────────┐
    │ Create/Verify All Permissions     │
    └───────────────┬───────────────────┘
                    │
                    ▼
    ┌───────────────────────────────────┐
    │ Load ALL Roles from Database      │
    └───────────────┬───────────────────┘
                    │
                    ▼
    ┌───────────────────────────────────┐
    │ For Each Role:                    │
    │                                   │
    │ Is Super Admin/Admin/HR?          │
    └───────────────┬───────────────────┘
                    │
         ┌──────────┴──────────┐
         │                     │
        YES                   NO
         │                     │
         ▼                     ▼
    ┌─────────┐         ┌──────────┐
    │ Assign  │         │  Assign  │
    │ Special │         │ Default  │
    │ Perms   │         │  Perms   │
    └────┬────┘         └────┬─────┘
         │                   │
         └─────────┬─────────┘
                   │
                   ▼
    ┌───────────────────────────────────┐
    │ Merge with Existing Permissions   │
    └───────────────┬───────────────────┘
                    │
                    ▼
    ┌───────────────────────────────────┐
    │ Save to Database                  │
    └───────────────┬───────────────────┘
                    │
                    ▼
    ┌───────────────────────────────────┐
    │ ✓ Role Updated Successfully       │
    └───────────────────────────────────┘


┌─────────────────────────────────────────────────────────────────────────────┐
│                          UI BEHAVIOR FLOW                                    │
└─────────────────────────────────────────────────────────────────────────────┘

    Profile Page Loads
            │
            ▼
    ┌───────────────────────────────────┐
    │ Check: Can edit own profile?      │
    └───────────────┬───────────────────┘
                    │
         ┌──────────┴──────────┐
         │                     │
        YES                   NO
         │                     │
         ▼                     ▼
    ┌─────────────┐     ┌──────────────┐
    │ Show:       │     │ Show:        │
    │ • Editable  │     │ • Readonly   │
    │ • Photo Up  │     │ • No Photo   │
    │ • Save Btn  │     │ • Warning    │
    └─────────────┘     └──────────────┘


┌─────────────────────────────────────────────────────────────────────────────┐
│                     DEFAULT PERMISSIONS (ALL ROLES)                          │
└─────────────────────────────────────────────────────────────────────────────┘

    ┌─────────────────────────────────────────────────────────────┐
    │                                                             │
    │  Profile Management.view own profile                       │
    │  Profile Management.edit own profile                       │
    │                                                             │
    │  Applied to:                                               │
    │  • Employee                                                │
    │  • Receptionist                                            │
    │  • Customer                                                │
    │  • Any Custom Role                                         │
    │  • Future Roles (automatic)                                │
    │                                                             │
    └─────────────────────────────────────────────────────────────┘


┌─────────────────────────────────────────────────────────────────────────────┐
│                          SECURITY LAYERS                                     │
└─────────────────────────────────────────────────────────────────────────────┘

    ┌─────────────────────────────────────────────────────────────┐
    │ Layer 1: Route Middleware (auth)                           │
    │ • Ensures user is logged in                                │
    └─────────────────────────────────────────────────────────────┘
                              │
                              ▼
    ┌─────────────────────────────────────────────────────────────┐
    │ Layer 2: Controller Permission Check                       │
    │ • Verifies user has required permission                    │
    │ • Returns 403 if unauthorized                              │
    └─────────────────────────────────────────────────────────────┘
                              │
                              ▼
    ┌─────────────────────────────────────────────────────────────┐
    │ Layer 3: View Permission Check                             │
    │ • Hides/disables UI elements                               │
    │ • Shows appropriate warnings                               │
    └─────────────────────────────────────────────────────────────┘
                              │
                              ▼
    ┌─────────────────────────────────────────────────────────────┐
    │ Layer 4: Form Validation                                   │
    │ • Validates data before saving                             │
    │ • Ensures data integrity                                   │
    └─────────────────────────────────────────────────────────────┘


╔══════════════════════════════════════════════════════════════════════════════╗
║                              QUICK REFERENCE                                 ║
╠══════════════════════════════════════════════════════════════════════════════╣
║                                                                              ║
║  Setup Command:                                                              ║
║  $ php sync_all_profile_permissions.php                                      ║
║                                                                              ║
║  Test URL:                                                                   ║
║  http://localhost/GitVraj/HrPortal/profile                                   ║
║                                                                              ║
║  Admin Panel:                                                                ║
║  http://localhost/GitVraj/HrPortal/roles                                     ║
║                                                                              ║
║  Default Access: ALL ROLES ✓                                                 ║
║  Special Access: Admin, HR ✓                                                 ║
║  Auto-Assignment: YES ✓                                                      ║
║                                                                              ║
╚══════════════════════════════════════════════════════════════════════════════╝
